{
    "version": "https://jsonfeed.org/version/1",
    "title": "叶泯希·杂七杂八的🐕窝 • All posts by \"apache\" tag",
    "description": "叶泯希的个人博客,yeminxiblog",
    "home_page_url": "https://yeminxi.github.io",
    "items": [
        {
            "id": "https://yeminxi.github.io/posts/f0f1ea42.html",
            "url": "https://yeminxi.github.io/posts/f0f1ea42.html",
            "title": "第六章 Centos 7 Linux配置web 实训任务：Apache服务器部署",
            "date_published": "2024-05-28T05:04:51.000Z",
            "content_html": "<h1 id=\"前言\"><a href=\"#前言\" class=\"headerlink\" title=\"前言\"></a>前言</h1><p><em><strong>&#x3D;&#x3D;前面的DNS一定要成功才能做！！！&#x3D;&#x3D;</strong></em><br>虚拟机需求：1台DNS服务器（Server）、1台Web服务器（Web Server）、1台客户端（Client1）</p>\n<blockquote>\n<p><strong>在第五章的基础上继续实训</strong></p>\n</blockquote>\n<h2 id=\"Apache服务器部署\"><a href=\"#Apache服务器部署\" class=\"headerlink\" title=\"Apache服务器部署\"></a>Apache服务器部署</h2><blockquote>\n<p>任务情境描述</p>\n<p>某公司需要搭建一台Web服务器，用于公司办公和网站宣传；还有另一台DNS服务器，用于实现Web服务器的域名解析。</p>\n</blockquote>\n<p> 网络拓扑图如下：<br><img src=\"https://ymxpic.pages.dev/file/f41d78cb8b0aed1fc5f16.png\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/f41d78cb8b0aed1fc5f16.png\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<blockquote>\n<p>部署信息如下：</p>\n<p>•        Server1为DNS服务器，IP地址为：192.168.1.10；</p>\n<p>•        Server2为Web服务器，IP地址为：192.168.1.100。</p>\n</blockquote>\n<blockquote>\n<h3 id=\"实训任务：\"><a href=\"#实训任务：\" class=\"headerlink\" title=\"实训任务：\"></a>实训任务：</h3><h4 id=\"任务1\"><a href=\"#任务1\" class=\"headerlink\" title=\"任务1\"></a>任务1</h4><p>搭建<a href=\"http://web1.mydomain.com的web1服务器,主目录是/var/www/web1%EF%BC%8C%E5%8F%AA%E5%85%81%E8%AE%B8192.168.1.0/24%E7%BD%91%E6%AE%B5%E7%9A%84%E4%B8%BB%E6%9C%BA%E8%AE%BF%E9%97%AE%E3%80%82\">http://web1.mydomain.com的web1服务器，主目录是/var/www/web1，只允许192.168.1.0/24网段的主机访问。</a></p>\n</blockquote>\n<blockquote>\n<h4 id=\"任务2\"><a href=\"#任务2\" class=\"headerlink\" title=\"任务2\"></a>任务2</h4><p>搭建基于8008端口号的安全服务器，可使用<a href=\"https://web2.mydomain.com:8008地址访问，主目录是/var/www/web2，使用CA颁发证书进行安全认证。\">https://web2.mydomain.com:8008地址访问，主目录是/var/www/web2，使用CA颁发证书进行安全认证。</a><br>“CSK Global Root CA”颁发机构颁发，网站证书信息如下：<br>    C &#x3D; CN<br>    ST &#x3D; China<br>    L &#x3D; GuangZhou<br>    O &#x3D; mydomain.com<br>    OU &#x3D; Operations Departments<br>    CN &#x3D; web2.mydomain.com</p>\n</blockquote>\n<blockquote>\n<h4 id=\"任务3-启动防火墙，SELinux设置为（Enforcing）。\"><a href=\"#任务3-启动防火墙，SELinux设置为（Enforcing）。\" class=\"headerlink\" title=\"任务3 启动防火墙，SELinux设置为（Enforcing）。\"></a>任务3 启动防火墙，SELinux设置为（Enforcing）。</h4></blockquote>\n<h2 id=\"一、配置Web服务器（Web-Server）的IP地址\"><a href=\"#一、配置Web服务器（Web-Server）的IP地址\" class=\"headerlink\" title=\"一、配置Web服务器（Web Server）的IP地址\"></a>一、配置Web服务器（Web Server）的IP地址</h2><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">BOOTPROTO=static</span><br><span class=\"line\">IPADDR=192.168.1.100</span><br><span class=\"line\">GATEWAY=192.168.1.2</span><br><span class=\"line\">NETMASK=255.255.255.0</span><br><span class=\"line\">DNS1=192.168.1.10</span><br><span class=\"line\">DNS2=202.96.128.86</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/3588694d141b24cb86fd7.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/3588694d141b24cb86fd7.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h2 id=\"二、在Web服务器（Web-Server）上生成CA证书\"><a href=\"#二、在Web服务器（Web-Server）上生成CA证书\" class=\"headerlink\" title=\"二、在Web服务器（Web Server）上生成CA证书\"></a>二、在Web服务器（Web Server）上生成CA证书</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> webserver]# cd /etc/pki/tls/certs/</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> certs]# make server.key</span><br><span class=\"line\"></span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> certs]# openssl rsa -in server.key -out server.key</span><br><span class=\"line\"></span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> certs]# make server.csr</span><br><span class=\"line\">umask <span class=\"number\">77</span> ; \\</span><br><span class=\"line\">/usr/bin/openssl req -utf8 -<span class=\"keyword\">new</span> -key server.key -out server.csr</span><br><span class=\"line\">You are about to be asked to enter information that will be incorporated</span><br><span class=\"line\">into your certificate request.</span><br><span class=\"line\">What you are about to enter is what is called a Distinguished Name or a DN.</span><br><span class=\"line\">There are quite a few fields but you can leave some blank</span><br><span class=\"line\">For some fields there will be a <span class=\"keyword\">default</span> value,</span><br><span class=\"line\">If you enter <span class=\"string\">&#x27;.&#x27;</span>, the field will be left blank.</span><br><span class=\"line\">-----</span><br><span class=\"line\">Country <span class=\"title function_\">Name</span> <span class=\"params\">(<span class=\"number\">2</span> letter code)</span> [XX]:CN</span><br><span class=\"line\">State or Province <span class=\"title function_\">Name</span> <span class=\"params\">(full name)</span> []:China</span><br><span class=\"line\">Locality <span class=\"title function_\">Name</span> <span class=\"params\">(eg, city)</span> [Default City]:GuangZhou</span><br><span class=\"line\">Organization <span class=\"title function_\">Name</span> <span class=\"params\">(eg, company)</span> [Default Company Ltd]:ymx.com</span><br><span class=\"line\">Organizational Unit <span class=\"title function_\">Name</span> <span class=\"params\">(eg, section)</span> []:Operations Deoartments</span><br><span class=\"line\">Common <span class=\"title function_\">Name</span> <span class=\"params\">(eg, your name or your server<span class=\"string\">&#x27;s hostname) []:web2.ymx.com</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">Email Address []:</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">Please enter the following &#x27;</span>extra<span class=\"string\">&#x27; attributes</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">to be sent with your certificate request</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">A challenge password []:</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">An optional company name []:</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">[root@webserver certs]# openssl x509 -in server.csr -out server.pem -req -signkey server.key -days 365</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\"></span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">[root@webserver certs]# chmod 400 server.*</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">[root@webserver certs]# yum -y install httpd mod_ssl</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\">[root@webserver certs]# systemctl restart httpd</span></span></span><br><span class=\"line\"><span class=\"string\"><span class=\"params\"></span></span></span><br></pre></td></tr></table></figure>\n<h3 id=\"1-修改OpenSSL配置文件\"><a href=\"#1-修改OpenSSL配置文件\" class=\"headerlink\" title=\"1. 修改OpenSSL配置文件\"></a>1. 修改OpenSSL配置文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/pki/tls/openssl.cnf\t<span class=\"comment\">//打开OpenSSL配置文件修改以下</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">my-ca.crt</span><br><span class=\"line\">my-ca.crl</span><br><span class=\"line\">my-ca.key</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/b77d1cae565a551339b87.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/b77d1cae565a551339b87.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[ req_distinguished_name ]</span><br><span class=\"line\">countryName                     = Country Name (2 letter code)</span><br><span class=\"line\">countryName_default             = CN</span><br><span class=\"line\">countryName_min                 = 2</span><br><span class=\"line\">countryName_max                 = 2</span><br><span class=\"line\"></span><br><span class=\"line\">stateOrProvinceName             = State or Province Name (full name)</span><br><span class=\"line\">stateOrProvinceName_default     = China</span><br><span class=\"line\"></span><br><span class=\"line\">localityName                    = Locality Name (eg, city)</span><br><span class=\"line\">localityName_default            = GuangZhou</span><br><span class=\"line\"></span><br><span class=\"line\">0.organizationName              = Organization Name (eg, company)</span><br><span class=\"line\">0.organizationName_default      = ymx.com</span><br><span class=\"line\"></span><br><span class=\"line\"># we can do this but it is not needed normally :-)</span><br><span class=\"line\">#1.organizationName             = Second Organization Name (eg, company)</span><br><span class=\"line\">#1.organizationName_default     = World Wide Web Pty Ltd</span><br><span class=\"line\"></span><br><span class=\"line\">organizationalUnitName          = Organizational Unit Name (eg, section)</span><br><span class=\"line\">organizationalUnitName_default  = Operations Deoartments</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/22226e0fd346c29fb2244.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/22226e0fd346c29fb2244.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\" alt=\"2\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">保存退出 :wq</span><br><span class=\"line\"> cd /etc/pki/CA/\t<span class=\"comment\">//进入CA目录</span></span><br><span class=\"line\"> ls\t\t\t\t\t<span class=\"comment\">//查看目录</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"2-生成CA文件\"><a href=\"#2-生成CA文件\" class=\"headerlink\" title=\"2. 生成CA文件\"></a>2. 生成CA文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">touch /etc/pki/CA/index.txt\t\t\t\t\t\t\t<span class=\"comment\">//新建一个放数据的文件</span></span><br><span class=\"line\">echo <span class=\"number\">01</span> &gt; /etc/pki/CA/serial\t\t\t\t\t\t<span class=\"comment\">//创建一个索引文件</span></span><br><span class=\"line\">openssl genrsa -out <span class=\"keyword\">private</span>/my-ca.key -des3 <span class=\"number\">2048</span>\t<span class=\"comment\">//生成CA文件，输入两次密码（请记住）</span></span><br></pre></td></tr></table></figure>\n<h3 id=\"3-生成公钥文件\"><a href=\"#3-生成公钥文件\" class=\"headerlink\" title=\"3. 生成公钥文件\"></a>3. 生成公钥文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -<span class=\"keyword\">new</span> -x509 -key <span class=\"keyword\">private</span>/my-ca.key -days <span class=\"number\">365</span> &gt; my-ca.crt\t<span class=\"comment\">//生成公钥文件</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/33e752e42d0501a1cd602.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/33e752e42d0501a1cd602.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"4-创建Server-key\"><a href=\"#4-创建Server-key\" class=\"headerlink\" title=\"4. 创建Server.key\"></a>4. 创建Server.key</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl genrsa -des3 -out server.key <span class=\"number\">2048</span>\t<span class=\"comment\">//创建server.key</span></span><br><span class=\"line\">ls\t\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//查看目录</span></span><br><span class=\"line\">openssl rsa -noout -text -in server.key\t\t<span class=\"comment\">//不输出以text文本查看server.key，输入保护密钥</span></span><br><span class=\"line\">cat server.key\t\t\t\t\t\t\t\t<span class=\"comment\">//查看</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/19e6298977aca66589e01.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/19e6298977aca66589e01.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">openssl req -<span class=\"keyword\">new</span> -key server.key -out server.csr\t<span class=\"comment\">//证书申请</span></span><br><span class=\"line\">ls\t\t\t\t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//查看目录</span></span><br><span class=\"line\">openssl ca -in server.csr -out server.crt\t\t\t<span class=\"comment\">//生成公钥文件，输入密码，两次确认</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/a8bf6e2992bbfd4c2526c.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/a8bf6e2992bbfd4c2526c.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h2 id=\"三、在DNS服务器（Server）上添加记录\"><a href=\"#三、在DNS服务器（Server）上添加记录\" class=\"headerlink\" title=\"三、在DNS服务器（Server）上添加记录\"></a>三、在DNS服务器（Server）上添加记录</h2><h3 id=\"1-添加正向区域记录\"><a href=\"#1-添加正向区域记录\" class=\"headerlink\" title=\"1. 添加正向区域记录\"></a>1. 添加正向区域记录</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /<span class=\"keyword\">var</span>/named/ymx.com.zone\t\t<span class=\"comment\">//打开正向区域文件</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$TTL 1D</span><br><span class=\"line\">@       IN SOA  dns ymx.com. (</span><br><span class=\"line\">                                        0       ; serial</span><br><span class=\"line\">                                        1D      ; refresh</span><br><span class=\"line\">                                        1H      ; retry</span><br><span class=\"line\">                                        1W      ; expire</span><br><span class=\"line\">                                        3H )    ; minimum</span><br><span class=\"line\">        NS      dns</span><br><span class=\"line\">dns     A       192.168.1.10</span><br><span class=\"line\">www     A       192.168.1.100</span><br><span class=\"line\">web1    A       192.168.1.100\t\t\t\t//添加这两条</span><br><span class=\"line\">web2    A       192.168.1.100</span><br><span class=\"line\">mail    A       192.168.1.200</span><br><span class=\"line\">ftp     CNAME   www</span><br><span class=\"line\">mail    MX 10   mail</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/79f13a2e82c1327208e20.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/79f13a2e82c1327208e20.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"2-添加反向区域记录\"><a href=\"#2-添加反向区域记录\" class=\"headerlink\" title=\"2. 添加反向区域记录\"></a>2. 添加反向区域记录</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /<span class=\"keyword\">var</span>/named/<span class=\"number\">1.168</span><span class=\"number\">.192</span>.zone\t<span class=\"comment\">//打开反向区域配置文件</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$TTL 1D</span><br><span class=\"line\">@       IN SOA  dns ymx.com. (</span><br><span class=\"line\">                                        0       ; serial</span><br><span class=\"line\">                                        1D      ; refresh</span><br><span class=\"line\">                                        1H      ; retry</span><br><span class=\"line\">                                        1W      ; expire</span><br><span class=\"line\">                                        3H )    ; minimum</span><br><span class=\"line\">        NS      dns</span><br><span class=\"line\">dns     A       192.168.1.10</span><br><span class=\"line\">10      PTR     dns.ymx.com.</span><br><span class=\"line\">100     PTR     web1.ymx.com.\t\t\t\t//添加这两条</span><br><span class=\"line\">100     PTR     web2.ymx.com.</span><br><span class=\"line\">100     PTR     www.ymx.com.</span><br><span class=\"line\">100     PTR     ftp.ymx.com.</span><br><span class=\"line\">200     PTR     mail.ymx.com.</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/72bd3ad32aabc83beac7c.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/72bd3ad32aabc83beac7c.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">systemctl restart named\t\t\t<span class=\"comment\">//重启dns服务</span></span><br></pre></td></tr></table></figure>\n<h2 id=\"四、在Web服务器（Web-Server）上安装httpd和mod-ssl服务\"><a href=\"#四、在Web服务器（Web-Server）上安装httpd和mod-ssl服务\" class=\"headerlink\" title=\"四、在Web服务器（Web Server）上安装httpd和mod_ssl服务\"></a>四、在Web服务器（Web Server）上安装httpd和mod_ssl服务</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">yum -y install http mod_ssl\t\t<span class=\"comment\">//安装</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/8c3e6d256b9c4e2debcaa.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/8c3e6d256b9c4e2debcaa.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"1-修改ssl配置文件\"><a href=\"#1-修改ssl配置文件\" class=\"headerlink\" title=\"1.修改ssl配置文件\"></a>1.修改ssl配置文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/httpd/conf.d/ssl.conf\t<span class=\"comment\">//修改配置文件</span></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Listen 8008 https\t\t\t\t\t\t\t\t\t//监听8008端口</span><br><span class=\"line\">&lt;VirtualHost *:8008&gt;\t\t\t\t\t\t\t\t//虚拟主机头</span><br><span class=\"line\">ServerName web2.ymx.com:8008\t\t\t\t\t\t//服务器名</span><br><span class=\"line\">DocumentRoot &quot;/var/www/web2&quot;\t\t\t\t\t\t//目录</span><br><span class=\"line\">SSLCertificateFile /etc/pki/CA/server.crt\t\t\t//ca证书文件</span><br><span class=\"line\">SSLCertificateKeyFile /etc/pki/CA/server.key \t\t//ca公钥文件</span><br><span class=\"line\">SSLCACertificateFile /etc/pki/CA/server.crt\t\t\t//ca私钥文件</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/ed674871c8806455ad6fd.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/ed674871c8806455ad6fd.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"2-新建网页\"><a href=\"#2-新建网页\" class=\"headerlink\" title=\"2. 新建网页\"></a>2. 新建网页</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# mkdir /<span class=\"keyword\">var</span>/www/web1</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# mkdir /<span class=\"keyword\">var</span>/www/web2</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# vim /<span class=\"keyword\">var</span>/www/html/index.html</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# vim /<span class=\"keyword\">var</span>/www/web1/index.html</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# vim /<span class=\"keyword\">var</span>/www/web2/index.html</span><br></pre></td></tr></table></figure>\n<h3 id=\"3-新建虚拟主机\"><a href=\"#3-新建虚拟主机\" class=\"headerlink\" title=\"3. 新建虚拟主机\"></a>3. 新建虚拟主机</h3> <figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vim /etc/httpd/conf.d/vhost.conf</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;VirtualHost www.ymx.com&gt;</span><br><span class=\"line\">ServerName www.ymx.com</span><br><span class=\"line\">DocumentRoot &quot;/var/www/html&quot;</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;VirtualHost web1.ymx.com&gt;</span><br><span class=\"line\">ServerName web1.ymx.com</span><br><span class=\"line\">DocumentRoot &quot;/var/www/web1&quot;</span><br><span class=\"line\">&lt;/VirtualHost&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;Directory &#x27;/var/www/web1&#x27;&gt;</span><br><span class=\"line\">Options Indexes FollowSymLinks</span><br><span class=\"line\">AllowOverride None</span><br><span class=\"line\">Order allow,deny</span><br><span class=\"line\">allow from 192.168.1.0/24\t//只允许192.168.1.0/24 通过</span><br><span class=\"line\">&lt;/Directory&gt;</span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/3398ac156559026841d36.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/3398ac156559026841d36.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> webserver]# systemctl restart httpd\t\t\t\t\t<span class=\"comment\">//重启http服务</span></span><br><span class=\"line\">Enter SSL pass phrase <span class=\"keyword\">for</span> web2.ymx.com:<span class=\"number\">8008</span> (RSA) : ****\t\t\t<span class=\"comment\">//输入密码</span></span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> webserver]# systemctl enable httpd\t\t\t\t\t<span class=\"comment\">//开机自启</span></span><br><span class=\"line\">Created symlink from /etc/systemd/system/multi-user.target.wants/httpd.service to /usr/lib/systemd/system/httpd.service.</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> webserver]# </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"5-修改httpd-conf配置文件\"><a href=\"#5-修改httpd-conf配置文件\" class=\"headerlink\" title=\"5. 修改httpd.conf配置文件\"></a>5. 修改httpd.conf配置文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# vim /etc/httpd/conf/httpd.conf </span><br><span class=\"line\">ServerName www.ymx.com:<span class=\"number\">80</span></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://ymxpic.pages.dev/file/dbfdaf9ea0c91291785a8.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/dbfdaf9ea0c91291785a8.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"6-防火墙设置\"><a href=\"#6-防火墙设置\" class=\"headerlink\" title=\"6. 防火墙设置\"></a>6. 防火墙设置</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# firewall-cmd --permanent --zone=<span class=\"keyword\">public</span> --add-service=http\t<span class=\"comment\">//开启http</span></span><br><span class=\"line\">success</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# firewall-cmd --permanent --zone=<span class=\"keyword\">public</span> --add-service=https\t<span class=\"comment\">//开启https</span></span><br><span class=\"line\">success</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# firewall-cmd --permanent --zone=<span class=\"keyword\">public</span> --add-port=<span class=\"number\">8008</span>/tcp\t<span class=\"comment\">//开启8008端口</span></span><br><span class=\"line\">success</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# firewall-cmd --permanent --zone=<span class=\"keyword\">public</span> --add-port=<span class=\"number\">8008</span>/udp</span><br><span class=\"line\">success</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# firewall-cmd --reload \t\t\t\t\t\t\t\t\t\t<span class=\"comment\">//重启防火墙</span></span><br><span class=\"line\">success</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# netstat -an | grep :<span class=\"number\">8008</span>\t\t\t\t\t\t\t\t\t<span class=\"comment\">//查看端口</span></span><br><span class=\"line\">tcp6       <span class=\"number\">0</span>      <span class=\"number\">0</span> :::<span class=\"number\">8008</span>                 :::*                    LISTEN     </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"7-复制证书文件\"><a href=\"#7-复制证书文件\" class=\"headerlink\" title=\"7. 复制证书文件\"></a>7. 复制证书文件</h3><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# cd /etc/pki/CA</span><br><span class=\"line\">[root<span class=\"meta\">@webserver</span> CA]# cp my-ca.crt /<span class=\"keyword\">var</span>/www/web1/</span><br></pre></td></tr></table></figure>\n<h3 id=\"8-客户端（Client-1）导入CA证书\"><a href=\"#8-客户端（Client-1）导入CA证书\" class=\"headerlink\" title=\"8. 客户端（Client 1）导入CA证书\"></a>8. 客户端（Client 1）导入CA证书</h3><h4 id=\"打开浏览器输入地址http-web1-ymx-com-my-ca-crt-下载证书文件并导入证书\"><a href=\"#打开浏览器输入地址http-web1-ymx-com-my-ca-crt-下载证书文件并导入证书\" class=\"headerlink\" title=\"打开浏览器输入地址http://web1.ymx.com/my-ca.crt 下载证书文件并导入证书\"></a>打开浏览器输入地址<a href=\"http://web1.ymx.com/my-ca.crt\">http://web1.ymx.com/my-ca.crt</a> 下载证书文件并导入证书</h4><p><img src=\"https://ymxpic.pages.dev/file/9ec2f9471a9bc62b2dc9c.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/9ec2f9471a9bc62b2dc9c.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h3 id=\"9-最终效果\"><a href=\"#9-最终效果\" class=\"headerlink\" title=\"9. 最终效果\"></a>9. 最终效果</h3><p><strong>http：&#x2F;&#x2F;web1.ymx.com<br><a href=\"https://web2.ymx.com:8008/\">https://web2.ymx.com:8008</a></strong><br><img src=\"https://ymxpic.pages.dev/file/0178b6492fb0d7a243482.jpg\" class=\"lazyload placeholder\" data-srcset=\"https://ymxpic.pages.dev/file/0178b6492fb0d7a243482.jpg\" srcset=\"https://pic1.zhimg.com/v2-cd38920285d125be80b3eb504052c550_b.webp\"></p>\n<h2 id=\"至此，实验结束\"><a href=\"#至此，实验结束\" class=\"headerlink\" title=\"至此，实验结束\"></a>至此，实验结束</h2>",
            "tags": [
                "服务器",
                "Linux",
                "CentOS",
                "Apache"
            ]
        }
    ]
}
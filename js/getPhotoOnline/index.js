const getPhotoJson={requestJsonAPI(e,t,n){let o=10;!function a(){return new Promise(((i,s)=>{let l=0,r=setTimeout((()=>{0===l&&(l=2,r=null,s("请求超时"),0==o&&n())}),5e3);fetch(e).then((function(e){if(2!==l&&(clearTimeout(r),i(e),r=null,l=1),e.ok)return e.json();throw new Error("Network response was not ok.")})).then((function(e){o=0,t(e)})).catch((function(e){o>0?(o-=1,setTimeout((()=>{a()}),5e3)):n()}))}))}()},filterData:(e,t)=>t.filter((e=>{let t=e.img||e.url||e.imgurl,n=t.substring(t.lastIndexOf(".")+1);if(["bmp","jpg","png","tif","gif","pcx","tga","exif","fpx","psd","cdr","pcd","dxf","ufo","eps","ai","raw","WMF","webp","jpeg"].includes(n))return e})),renderBox(e,t,n,o,a,i="",s=""){let l=o?2:getPhotoJson.getRandomRange(2,4,i);i=l;let r=t;t+=l;let c="",g=e.slice(r,t);t>=e.length&&(l=g.length);for(let e=0;e<g.length;e++){let t=g[e].img||g[e].url||g[e].imgurl,n=g[e].alt||g[e].title;c+=`<div class="fancybox"><a href="${t}" class="fancybox" data-fancybox="images" data-caption="${n}"><img src="${t}" alt="${n}" /></a><span class="image-caption">${n}</span></div>`}let d=`<div class="gallery stretch" col="${l}">${c}</div>`;return $(a).find(".waterfall-picture-container").append(d),s+=d,t<e.length?getPhotoJson.renderBox(e,t,n,o,a,i,s):s},getRandomRange(e,t,n){let o=Math.floor(Math.random()*(t-e+1))+e;return n===o?getPhotoJson.getRandomRange(e,t,n):o},getJsonAPIForSites(e){const t=$(e.el)[0];$(t).append('<div class="loading"><i class="fas fa-cog fa-2x fa-spin"></i><p>正在加载</p></div>'),this.requestJsonAPI(e.api,(function(n){$(t).find(".loading").remove();const o=getPhotoJson.filterData(e,n);$(t).append('<div class="waterfall-picture-container"></div>');if(o.length>0){let n=e.isRegular||null;getPhotoJson.renderBox(o,0,e.api,n,t)}else $(t).find(".waterfall-picture-container").append(`<p style="color:red">${e.api} 没有图片链接</p>`)}),(function(){$(t).find(".loading i").remove(),$(t).find(".loading p").text("加载失败，请稍后重试。")}))},request(){const e=document.getElementsByClassName("getJsonPhoto-api");for(var t=0;t<e.length;t++){const o=e[t],a=o.getAttribute("api"),i=o.getAttribute("isRegular");var n=new Object;n.class=o.getAttribute("class"),n.el=o,n.api=a,n.isRegular=i,this.getJsonAPIForSites(n)}}};getPhotoJson.request(),document.addEventListener("pjax:complete",(function(){getPhotoJson.request()}));